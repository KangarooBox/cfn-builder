"config":{
  "commands":{
    "aEnableCloudWatch":{
      "command":"$path='C:\\Program Files\\Amazon\\Ec2ConfigService\\Settings\\config.xml';$xml=[xml](Get-Content $path);$node=$xml.Ec2ConfigurationSettings.Plugins.Plugin | where {$_.Name -eq 'AWS.EC2.Windows.CloudWatch.PlugIn'};$node.State='Enabled';$xml.Save($path)"
    },
    "zRestartEc2Config":{
      "command":"Restart-Service Ec2Config"
    }
  },
  "files":{
    "C:\\Program Files\\Amazon\\Ec2ConfigService\\Settings\\AWS.EC2.Windows.CloudWatch.json":{
      "content":{
        "EngineConfiguration":{
          "PollInterval":"00:00:15",
          "Components":[
            { "Id":"ApplicationEventLog",
              "FullName":"AWS.EC2.Windows.CloudWatch.EventLog.EventLogInputComponent,AWS.EC2.Windows.CloudWatch",
              "Parameters":{"LogName":"Application", "Levels":"1"}
            },
            { "Id":"SystemEventLog",
              "FullName":"AWS.EC2.Windows.CloudWatch.EventLog.EventLogInputComponent,AWS.EC2.Windows.CloudWatch",
              "Parameters":{"LogName":"System", "Levels":"7"}
            },
            { "Id":"SecurityEventLog",
              "FullName":"AWS.EC2.Windows.CloudWatch.EventLog.EventLogInputComponent,AWS.EC2.Windows.CloudWatch",
              "Parameters":{"LogName":"Security", "Levels":"7"}
            },
            { "Id":"ETW",
              "FullName":"AWS.EC2.Windows.CloudWatch.EventLog.EventLogInputComponent,AWS.EC2.Windows.CloudWatch",
              "Parameters":{"LogName":"Microsoft-Windows-WinINet/Analytic", "Levels":"7"}
            },
            { "Id":"IISLogs",
              "FullName":"AWS.EC2.Windows.CloudWatch.CustomLog.CustomLogInputComponent,AWS.EC2.Windows.CloudWatch",
              "Parameters":{
                "LogDirectoryPath":"C:\\inetpub\\logs\\LogFiles\\W3SVC1",
                "TimestampFormat":"yyyy-MM-dd HH:mm:ss",
                "Encoding":"UTF-8",
                "Filter":"",
                "CultureName":"en-US",
                "TimeZoneKind":"UTC",
                "LineCount":"3"
              }
            },
            { "Id":"CustomLogs",
              "FullName":"AWS.EC2.Windows.CloudWatch.CustomLog.CustomLogInputComponent,AWS.EC2.Windows.CloudWatch",
              "Parameters":{
                "LogDirectoryPath":"C:\\CustomLogs\\",
                "TimestampFormat":"MM/dd/yyyy HH:mm:ss",
                "Encoding":"UTF-8",
                "Filter":"",
                "CultureName":"en-US",
                "TimeZoneKind":"Local"
              }
            },
            { "Id":"PerformanceCounter",
              "FullName":"AWS.EC2.Windows.CloudWatch.PerformanceCounterComponent.PerformanceCounterInputComponent,AWS.EC2.Windows.CloudWatch",
              "Parameters":{
                "CategoryName":"Memory",
                "CounterName":"Available MBytes",
                "InstanceName":"",
                "MetricName":"Memory",
                "Unit":"Megabytes",
                "DimensionName":"",
                "DimensionValue":""
              }
            },
            { "Id":"CloudWatchLogs",
              "FullName":"AWS.EC2.Windows.CloudWatch.CloudWatchLogsOutput,AWS.EC2.Windows.CloudWatch",
              "Parameters":{"Region":"{{@root.Region.Id}}", "LogGroup":"{{@root.ProjectName}}-{{@root.EnvVersion}}{{@root.EnvType}}", "LogStream":"{instance_id}"}
            },
            { "Id":"CloudWatch",
              "FullName":"AWS.EC2.Windows.CloudWatch.CloudWatch.CloudWatchOutputComponent,AWS.EC2.Windows.CloudWatch",
              "Parameters":{"Region":"{{@root.Region.Id}}", "NameSpace":"{{@root.ProjectName}}/{{@root.EnvVersion}}{{@root.EnvType}}"}
            }
          ],
          "Flows":{
            "Flows":["(ApplicationEventLog,SystemEventLog,SecurityEventLog),CloudWatchLogs", "PerformanceCounter,CloudWatch"]
          }
        }
      }
    }
  }
}
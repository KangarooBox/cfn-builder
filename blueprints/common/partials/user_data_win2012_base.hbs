"UserData":{ "Fn::Base64":{ "Fn::Join":["\n", [
  "<powershell>",
  {{#if @root.Password}}
  " $passwd = '{{@root.Password}}'",
  " net user Administrator $passwd",
  {{/if}}
  {{#if @root.SSMDocumentName}}
  " Set-DefaultAWSRegion -Region {{@root.Region.Id}}",
  " Set-Variable -name instance_id -value (Invoke-Restmethod -uri http://169.254.169.254/latest/meta-data/instance-id)",
  " New-SSMAssociation -InstanceId $instance_id -Name \"{{@root.SSMDocumentName}}\"",
  {{/if}}
  " Read-S3Object -BucketName {{@root.Region.ArtifactsBucket}} -Key user-data/{{lowercase @root.ProjectName}}.{{lowercase @root.EnvName}}.ps1 -File $env:PROGRAMFILES\\Amazon\\Ec2ConfigService\\Scripts\\userdata.ps1",
  " Set-ExecutionPolicy Unrestricted",
  " & $env:PROGRAMFILES\\Amazon\\Ec2ConfigService\\Scripts\\userdata.ps1 >> $env:PROGRAMFILES\\Amazon\\Ec2ConfigService\\Logs\\userdata.txt",
  "</powershell>"
]]}}
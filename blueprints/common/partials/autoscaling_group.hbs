{{!--
 Creates a new Amazon Autoscaling Group.

  http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-group.html
 --}}
"asg{{this.Name}}":{
  "Type":"AWS::AutoScaling::AutoScalingGroup",
  "Properties":{
    "LaunchConfigurationName":{ "Ref":"aslc{{this.LaunchConfigurationName}}" },

    "VPCZoneIdentifier":[
    {{!-- Restrict the instance to a specific subnet group (a,b,c,d,e,etc.) --}}
    {{#if this.SubnetIndex}}
      {{#each (lookupByNode @root.Region.SubnetIds this.SubnetId)}}
        {{!--
          JSON considers 0 to be false but NodeJS arrays are zero based, so we have
          to do some adjustments here.
        --}}
        {{#ifEq @index (subtract ../SubnetIndex 1)}}
          "{{this}}"
        {{/ifEq}}
      {{/each}}
    {{else}}
      {{!-- Launch an instance into any subnet group --}}
      {{#each @root.Region.Subnets as |subnet name|}}
        {{#each subnet.addresses}}
          {{#ifEq ../../SubnetId name}}
            "{{this.Id}}"{{#unless @last}},{{/unless}}
          {{/ifEq}}
        {{/each}}
      {{/each}}
    {{/if}}
    ],

    {{#if this.LoadBalancerNames}}
    "LoadBalancerNames":[{{#each this.LoadBalancerNames}}{"Ref":"elb{{this}}"}{{#unless @last}},{{/unless}}{{/each}} ],
    {{/if}}

    {{#if this.TargetGroupARNs}}
    "TargetGroupARNs":[{{#each this.TargetGroupARNs}}{"Ref":"elbv2tg{{this}}"}{{#unless @last}},{{/unless}}{{/each}} ],
    {{/if}}

    "MinSize":{{default this.MinSize 0}},
    "MaxSize":{{default this.MaxSize 0}},
    "DesiredCapacity":{{default this.DesiredCapacity 0}},
    "HealthCheckGracePeriod":{{default this.HealthCheckGracePeriod 300}},

    {{> ec2_tags }}
  }
}

{{!--
 Creates a new Amazon Autoscaling Group.

  http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-group.html
 --}}
"asg{{sanitize this.Name ''}}":{
  "Type":"AWS::AutoScaling::AutoScalingGroup",
  "Properties":{
    "AutoScalingGroupName": "{{this.Name}}",
    {{#if this.Cooldown}}"Cooldown": "{{this.Cooldown}}",{{/if}}
    "LaunchConfigurationName":{ "Ref":"aslc{{this.LaunchConfigurationName}}" },

    {{#if this.AvailabilityZones}}
      "AvailabilityZones": [{{#each this.AvailabilityZones}}"{{this}}"{{#unless @last}},{{/unless}}{{/each}}],
    {{/if}}
    "VPCZoneIdentifier":[
      {{!-- Restrict the instance to a specific subnet group (a,b,c,d,e,etc.) --}}
      {{#if this.SubnetIndex}}
        {{#each (lookupByNode @root.Region.Subnets this.SubnetId)}}
          {{#each this}}
            {{#ifEq this.AZ ../../SubnetIndex}}"{{this.Id}}"{{/ifEq}}
          {{/each}}
        {{/each}}

      {{else}}
        {{!-- Launch an instance into any subnet group --}}
        {{#each @root.Region.Subnets as |subnet name|}}
          {{#each subnet.addresses}}
            {{#ifEq ../../SubnetId name}}
              "{{this.Id}}"{{#unless @last}},{{/unless}}
            {{/ifEq}}
          {{/each}}
        {{/each}}
      {{/if}}
    ],


    {{#if this.LifecycleHookSpecificationList}}
      "LifecycleHookSpecificationList": [{{#each this.LifecycleHookSpecificationList}}
        { {{{inject this.LifecycleHookSpecificationList}}} }{{#unless @last}},{{/unless}}
      {{/each}}],
    {{/if}}

    {{#if this.MetricsCollection}}
      "MetricsCollection": [ {{#each this.MetricsCollection}}{ {{{inject this}}} }{{#unless @last}},{{/unless}}{{/each}} ],
    {{/if}}

    {{#if this.NotificationConfigurations}}{{#with this.NotificationConfigurations}}
      "NotificationConfigurations": [{{#each this}}
        { "NotificationTypes": [{{#each this.NotificationTypes}}"{{this}}"{{#unless @last}},{{/unless}}{{/each}}],
          "TopicARN": "{{this.TopicARN}}"
        }{{#unless @last}},{{/unless}}
      {{/each}}],
    {{/with}}{{/if}}

    {{#if this.LoadBalancerNames}}
    "LoadBalancerNames":[{{#each this.LoadBalancerNames}}{"Ref":"elb{{this}}"}{{#unless @last}},{{/unless}}{{/each}} ],
    {{/if}}

    {{#if this.TargetGroupARNs}}
    "TargetGroupARNs":[{{#each this.TargetGroupARNs}}{"Ref":"elbv2tg{{this}}"}{{#unless @last}},{{/unless}}{{/each}} ],
    {{/if}}

    "HealthCheckGracePeriod":{{default this.HealthCheckGracePeriod 300}},
    {{#if this.HealthCheckType}}"HealthCheckType":"{{this.HealthCheckType}}",{{/if}}

    "MinSize":{{default this.MinSize 0}},
    "MaxSize":{{default this.MaxSize 0}},
    "DesiredCapacity":{{default this.DesiredCapacity 0}},
    {{> ec2_tags }}
  }
}



{{!-- TODO
      "InstanceId" : String,
      "LaunchTemplate" : LaunchTemplateSpecification,
      "MixedInstancesPolicy" : MixedInstancesPolicy,
      "PlacementGroup" : String,
      "ServiceLinkedRoleARN" : String,
      "TerminationPolicies" : [ String, ... ],
 --}}